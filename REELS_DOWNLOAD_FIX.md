# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ü—Ä–æ–±–ª–µ–º —Å–æ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ–º –†–∏–ª—Å–æ–≤

## üêõ –ü—Ä–æ–±–ª–µ–º—ã –ö–æ—Ç–æ—Ä—ã–µ –ë—ã–ª–∏

### 1. **–ù–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**
- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª—Å—è
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–∏–¥–µ–ª –ø—Ä–æ—Ü–µ—Å—Å —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

### 2. **–û—à–∏–±–∫–∞ "Timed out" –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è**
- –í–∏–¥–µ–æ —Å–∫–∞—á–∏–≤–∞–ª–æ—Å—å —É—Å–ø–µ—à–Ω–æ
- –û—Ç–ø—Ä–∞–≤–ª—è–ª—Å—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
- –ù–æ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞—Å—å –æ—à–∏–±–∫–∞ "Timed out"

### 3. **"–ù–µ–≤–µ—Ä–Ω–∞—è —Å—Å—ã–ª–∫–∞" –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø–æ–¥–ø–∏—Å–∏**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–ª –ø–æ–¥–ø–∏—Å—å –∫ —Ä–∏–ª—Å—É
- –ü–æ–ª—É—á–∞–ª –æ—à–∏–±–∫—É "–ù–µ–≤–µ—Ä–Ω–∞—è —Å—Å—ã–ª–∫–∞! –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ —Ä–∏–ª—Å –∏–∑ Instagram"
- –ù–µ –º–æ–≥ –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Ä–∏–ª—Å

## üîç –ü—Ä–∏—á–∏–Ω—ã –ü—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ü—Ä–æ–≥—Ä–µ—Å—Å –Ω–µ —Ä–∞–±–æ—Ç–∞–ª
**–ü—Ä–∏—á–∏–Ω–∞:**
- Progress callback –≤—ã–∑—ã–≤–∞–ª—Å—è –∏–∑ thread pool executor
- `asyncio.get_event_loop()` –≤ –¥—Ä—É–≥–æ–º –ø–æ—Ç–æ–∫–µ –≤–æ–∑–≤—Ä–∞—â–∞–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π loop
- Callback –Ω–µ –º–æ–≥ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∫–æ—Ä—É—Ç–∏–Ω—ã –≤ –æ—Å–Ω–æ–≤–Ω–æ–º event loop

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ preview
**–ü—Ä–∏—á–∏–Ω–∞:**
- –ë–æ–ª—å—à–∏–µ –≤–∏–¥–µ–æ —Ñ–∞–π–ª—ã –≤—ã–∑—ã–≤–∞–ª–∏ timeout –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —á–µ—Ä–µ–∑ Telegram
- Exception –ª–æ–≤–∏–ª—Å—è –æ–±—â–∏–º `try-except`
- –ü–æ–∫–∞–∑—ã–≤–∞–ª–∞—Å—å –æ—à–∏–±–∫–∞ "–ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏", —Ö–æ—Ç—è —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –±—ã–ª–æ —É—Å–ø–µ—à–Ω—ã–º
- –°–æ—Å—Ç–æ—è–Ω–∏–µ (`step`) —Å–±—Ä–∞—Å—ã–≤–∞–ª–æ—Å—å –Ω–∞ `'reels_url_input'`

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ù–µ–≤–µ—Ä–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
**–ü—Ä–∏—á–∏–Ω–∞:**
- –ü–æ—Å–ª–µ –æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ preview, `user_state['step']` —Å–±—Ä–∞—Å—ã–≤–∞–ª—Å—è –Ω–∞ `'reels_url_input'`
- –ù–æ –≤–∏–¥–µ–æ —É–∂–µ –±—ã–ª–æ —Å–∫–∞—á–∞–Ω–æ –∏ preview –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
- –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø–æ–¥–ø–∏—Å–∏, –±–æ—Ç –¥—É–º–∞–ª —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç URL
- –í–∞–ª–∏–¥–∞—Ü–∏—è URL –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∞ ‚Üí "–ù–µ–≤–µ—Ä–Ω–∞—è —Å—Å—ã–ª–∫–∞"

## ‚úÖ –†–µ—à–µ–Ω–∏—è

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: Event Loop –¥–ª—è Progress

**–ë—ã–ª–æ:**
```python
def sync_progress_callback(downloaded: int, total: int):
    loop = asyncio.get_event_loop()  # ‚Üê WRONG! –í –¥—Ä—É–≥–æ–º –ø–æ—Ç–æ–∫–µ —ç—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
    asyncio.run_coroutine_threadsafe(
        progress_callback(downloaded, total),
        loop
    )
```

**–°—Ç–∞–ª–æ:**
```python
# –ü–æ–ª—É—á–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –≥–ª–∞–≤–Ω—ã–π loop –î–û –≤—Ö–æ–¥–∞ –≤ executor
main_loop = asyncio.get_event_loop()

def sync_progress_callback(downloaded: int, total: int):
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –≥–ª–∞–≤–Ω—ã–π loop
    asyncio.run_coroutine_threadsafe(
        progress_callback(downloaded, total),
        main_loop  # ‚Üê CORRECT!
    )
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ Try-Catch

**–ë—ã–ª–æ:**
```python
try:
    # –°–∫–∞—á–∞—Ç—å –≤–∏–¥–µ–æ
    video_path = ...
    
    # –û–±–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    user_state['step'] = 'reels_waiting_caption'
    
    # –û—Ç–ø—Ä–∞–≤–∏—Ç—å preview
    await update.message.reply_video(...)
    
except Exception as e:
    # ‚ùå –õ–Æ–ë–ê–Ø –æ—à–∏–±–∫–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ!
    await processing_msg.edit_text(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ —Ä–∏–ª—Å–∞: {e}")
    user_state['step'] = 'reels_url_input'  # ‚Üê –ü–†–û–ë–õ–ï–ú–ê!
```

**–°—Ç–∞–ª–æ:**
```python
# Try-catch —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
try:
    video_path = ...
except Exception as e:
    await processing_msg.edit_text(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏: {e}")
    user_state['step'] = 'reels_url_input'
    return

# –ï—Å–ª–∏ —Å–∫–∞—á–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ - –æ–±–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –°–†–ê–ó–£
user_state['step'] = 'reels_waiting_caption'

# –û—Ç–¥–µ–ª—å–Ω—ã–π try-catch –¥–ª—è preview (–Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ!)
try:
    await update.message.reply_video(...)
except Exception as e:
    # ‚úÖ –í–∏–¥–µ–æ —Å–∫–∞—á–∞–Ω–æ, —Å–æ—Å—Ç–æ—è–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
    # –ü—Ä–æ—Å—Ç–æ —Å–æ–æ–±—â–∞–µ–º —á—Ç–æ preview –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏–ª—Å—è
    await update.message.reply_text(
        "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä (–≤–∏–¥–µ–æ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ)\n\n"
        "–ù–æ –≤–∏–¥–µ–æ —Å–∫–∞—á–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ! –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ø–æ–¥–ø–∏—Å—å:"
    )
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 3: –û–±—Ä–∞–±–æ—Ç–∫–∞ content-length

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
```python
# –í instagram_service.py
total_size = int(video_response.headers.get('content-length', 0))

if total_size > 0:
    logger.info(f"Total file size: {total_size / (1024*1024):.2f} MB")
else:
    logger.warning("Total file size unknown (no content-length header)")

# –í—ã–∑—ã–≤–∞—Ç—å progress_callback –¥–∞–∂–µ –µ—Å–ª–∏ total_size = 0
if progress_callback:
    progress_callback(downloaded_size, total_size)  # total –º–æ–∂–µ—Ç –±—ã—Ç—å 0
```

**–ò –≤ admin_handler.py:**
```python
if total > 0:
    # –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —Å –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏
    percent = (downloaded / total) * 100
    progress_bar = "‚ñà" * int(percent / 5) + "‚ñë" * (20 - int(percent / 5))
    # ...
else:
    # –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ä–∞–∑–º–µ—Ä —Å–∫–∞—á–∞–Ω–Ω–æ–≥–æ
    await processing_msg.edit_text(
        f"‚è≥ –°–∫–∞—á–∏–≤–∞—é —Ä–∏–ª—Å...\n"
        f"üíæ –°–∫–∞—á–∞–Ω–æ: {downloaded_mb:.2f} –ú–ë"
    )
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 4: Telegram Timeouts

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
```python
await update.message.reply_video(
    video=video,
    caption="...",
    read_timeout=60,   # ‚Üê –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π timeout –¥–ª—è —á—Ç–µ–Ω–∏—è
    write_timeout=60   # ‚Üê –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π timeout –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
)
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 5: –î–µ—Ç–∞–ª—å–Ω–æ–µ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ –≤—Å–µ –∫–ª—é—á–µ–≤—ã–µ —Ç–æ—á–∫–∏:**

```python
# –í admin_handler.py
logger.info(f"Starting reels download from: {reels_url}")
logger.info(f"Download completed, video_path: {video_path}")
logger.info(f"Progress update: {percent:.1f}% ({downloaded_mb:.2f}/{total_mb:.2f} MB)")
logger.error(f"Error in sync progress callback wrapper: {e}")
logger.error(f"Traceback: {traceback.format_exc()}")

# –í instagram_service.py
logger.info(f"Total file size: {total_size / (1024*1024):.2f} MB")
logger.warning("Total file size unknown (no content-length header)")
logger.debug(f"Progress callback called: {downloaded_size / (1024*1024):.2f} MB")
logger.error(f"Error calling progress_callback: {e}")
```

## üìä –¢–∞–±–ª–∏—Ü–∞ –ò–∑–º–µ–Ω–µ–Ω–∏–π

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ë—ã–ª–æ | –°—Ç–∞–ª–æ |
|-----------|------|-------|
| **Event Loop** | `get_event_loop()` –≤ –ø–æ—Ç–æ–∫–µ | –°—Å—ã–ª–∫–∞ –Ω–∞ main_loop |
| **Try-Catch** | –û–¥–∏–Ω –±–ª–æ–∫ –¥–ª—è –≤—Å–µ–≥–æ | –†–∞–∑–¥–µ–ª—å–Ω—ã–µ –±–ª–æ–∫–∏ |
| **–°–æ—Å—Ç–æ—è–Ω–∏–µ** | –°–±—Ä–∞—Å—ã–≤–∞–ª–æ—Å—å –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ | –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –µ—Å–ª–∏ –≤–∏–¥–µ–æ —Å–∫–∞—á–∞–Ω–æ |
| **Progress** | –¢–æ–ª—å–∫–æ –ø—Ä–∏ total > 0 | –í—Å–µ–≥–¥–∞ (–∞–¥–∞–ø—Ç–∏–≤–Ω–æ) |
| **Telegram timeout** | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é (20s) | 60s –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ |
| **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** | –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ | –î–µ—Ç–∞–ª—å–Ω–æ–µ –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ |

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
```
1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —Ä–∏–ª—Å
2. "‚è≥ –°–∫–∞—á–∏–≤–∞—é —Ä–∏–ª—Å..." [–±–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π]
3. "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ —Ä–∏–ª—Å–∞: Timed out"
4. [–Ω–æ –≤–∏–¥–µ–æ –ø–æ—è–≤–ª—è–µ—Ç—Å—è] "–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–∏–ª—Å–∞"
5. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å—å
6. "‚ùå –ù–µ–≤–µ—Ä–Ω–∞—è —Å—Å—ã–ª–∫–∞!"
```

### –ü–æ—Å–ª–µ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
```
1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —Ä–∏–ª—Å
2. "‚è≥ –°–∫–∞—á–∏–≤–∞—é —Ä–∏–ª—Å..."
3. "üìä –ü—Ä–æ–≥—Ä–µ—Å—Å: 25.5% [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë]"
4. "üìä –ü—Ä–æ–≥—Ä–µ—Å—Å: 67.8% [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë]"
5. "‚úÖ –†–∏–ª—Å —É—Å–ø–µ—à–Ω–æ —Å–∫–∞—á–∞–Ω!"
6. [–≤–∏–¥–µ–æ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä] "–û—Ç–ø—Ä–∞–≤—å—Ç–µ –ø–æ–¥–ø–∏—Å—å:"
7. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å—å
8. "üìã –ì–æ—Ç–æ–≤–æ –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏!"
9. ‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!
```

### –ï—Å–ª–∏ Preview –ù–µ –û—Ç–ø—Ä–∞–≤–∏–ª—Å—è
```
...
5. "‚úÖ –†–∏–ª—Å —É—Å–ø–µ—à–Ω–æ —Å–∫–∞—á–∞–Ω!"
6. "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä (–≤–∏–¥–µ–æ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ)"
   "–ù–æ –≤–∏–¥–µ–æ —Å–∫–∞—á–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ! –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ø–æ–¥–ø–∏—Å—å:"
7. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å—å
8. "üìã –ì–æ—Ç–æ–≤–æ –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏!"
9. ‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!
```

## üî¨ –¢–µ—Å—Ç–æ–≤—ã–µ –°—Ü–µ–Ω–∞—Ä–∏–∏

### –¢–µ—Å—Ç 1: –ú–∞–ª–µ–Ω—å–∫–∏–π —Ñ–∞–π–ª (< 20 –ú–ë)
```
‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
‚úÖ Preview –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
‚úÖ –ü–æ–¥–ø–∏—Å—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è
‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
```

### –¢–µ—Å—Ç 2: –ë–æ–ª—å—à–æ–π —Ñ–∞–π–ª (> 50 –ú–ë)
```
‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
‚ö†Ô∏è Preview –º–æ–∂–µ—Ç –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è (Telegram –ª–∏–º–∏—Ç 50 –ú–ë)
‚úÖ –ù–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
‚úÖ –ü–æ–¥–ø–∏—Å—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è
‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (—Ñ–∞–π–ª —É–∂–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
```

### –¢–µ—Å—Ç 3: –ë–µ–∑ content-length
```
‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å–∫–∞—á–∞–Ω–Ω–æ–µ
‚úÖ –°–∫–∞—á–∏–≤–∞–µ—Ç—Å—è –¥–æ –∫–æ–Ω—Ü–∞
‚úÖ –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
```

### –¢–µ—Å—Ç 4: –ú–µ–¥–ª–µ–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
```
‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (–º–µ–¥–ª–µ–Ω–Ω–æ)
‚úÖ –ú–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å
‚úÖ –ù–µ—Ç —Ç–∞–π–º–∞—É—Ç–æ–≤
```

## üìù –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –§–∞–π–ª—ã

### `handlers/admin_handler.py`
**–°—Ç—Ä–æ–∫–∏ 1724-1808:**
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ main_loop –¥–æ executor
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω—ã–π sync_progress_callback
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–Ω—ã–µ try-catch –±–ª–æ–∫–∏
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
- ‚úÖ –û—Ç–¥–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ preview
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°—Ç—Ä–æ–∫–∏ 1694-1734:**
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ total = 0 –≤ progress_callback
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

### `services/instagram_service.py`
**–°—Ç—Ä–æ–∫–∏ 547-580:**
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è content-length
- ‚úÖ –í—ã–∑–æ–≤ progress_callback –≤—Å–µ–≥–¥–∞ (–Ω–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ total > 0)
- ‚úÖ Try-catch –≤–æ–∫—Ä—É–≥ –≤—ã–∑–æ–≤–∞ progress_callback
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

## üéì –£—Ä–æ–∫–∏

### –ß—Ç–æ –£–∑–Ω–∞–ª–∏
1. **Event Loop Context**: –ù–µ–ª—å–∑—è –≤—ã–∑—ã–≤–∞—Ç—å `get_event_loop()` –≤ thread pool executor
2. **State Management**: –†–∞–∑–¥–µ–ª—è—Ç—å —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ –æ—à–∏–±–∫–∏ UI
3. **Error Handling**: –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ try-catch –±–ª–æ–∫–∏ –ª—É—á—à–µ –æ–¥–Ω–æ–≥–æ –±–æ–ª—å—à–æ–≥–æ
4. **Telegram Limits**: 50 –ú–ë –ª–∏–º–∏—Ç –Ω–∞ –≤–∏–¥–µ–æ –≤ –±–æ—Ç–µ
5. **Progress Reporting**: –ù—É–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–ª—É—á–∞–π –±–µ–∑ total size

### Best Practices
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ main loop –ø–µ—Ä–µ–¥ executor
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –ù–µ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑-–∑–∞ –æ—à–∏–±–æ–∫ UI
- ‚úÖ –í—Å–µ–≥–¥–∞ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å traceback
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã (total=0, timeouts, –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã)

## üöÄ –ß—Ç–æ –¢–µ–ø–µ—Ä—å –†–∞–±–æ—Ç–∞–µ—Ç

- ‚úÖ **–ü—Ä–æ–≥—Ä–µ—Å—Å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏** - –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
- ‚úÖ **–ù–µ—Ç –ª–æ–∂–Ω—ã—Ö –æ—à–∏–±–æ–∫** - "Timed out" –±–æ–ª—å—à–µ –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ** - –ø–æ–¥–ø–∏—Å—å –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è
- ‚úÖ **–ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã** - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ **–î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏** - –ª–µ–≥–∫–æ –¥–µ–±–∞–∂–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
- ‚úÖ **Graceful degradation** - –µ—Å–ª–∏ preview –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—É–±–ª–∏–∫–∞—Ü–∏—è –≤—Å–µ —Ä–∞–≤–Ω–æ –∏–¥–µ—Ç

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û  
**–í–µ—Ä—Å–∏—è:** 2.0.0  
**–î–∞—Ç–∞:** 21 –æ–∫—Ç—è–±—Ä—è 2025  

**–¢–µ–ø–µ—Ä—å —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Ä–∏–ª—Å–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ!** üéâ

