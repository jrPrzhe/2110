# 📋 Полный Workflow Бота

## 🎯 Основная концепция

Бот автоматизирует публикацию контента в Instagram, Telegram и VK. Он работает через личные сообщения в Telegram и поддерживает 3 типа контента:
- **Фото-посты** (одиночные или карусели)
- **Видео-посты** (прямая загрузка видео)
- **Рилсы** (скачивание и репостинг из Instagram)

---

## 🚀 Основной Workflow (ПРОСТОЙ ПУТЬ)

### Шаг 1: Старт
```
Отправьте команду /start
↓
Нажмите кнопку "🚀 Начать публикацию"
```

### Шаг 2: Выбор платформы
```
Выберите куда публиковать:
┌─────────────────────────────────┐
│ 📷 Instagram      💬 Telegram   │
│ 🔵 VK             🔀 Все        │
└─────────────────────────────────┘
```

**Платформы:**
- **📷 Instagram** - публикация только в Instagram
- **💬 Telegram** - публикация только в Telegram группу
- **🔵 VK** - публикация только в VK группу
- **🔀 Все платформы** - публикация сразу во все три

### Шаг 3: Выбор проверки артикулов (только для Instagram/Telegram/VK)
```
Нужно ли искать артикулы?
┌─────────────────────────────────┐
│ 🔍 Да, искать артикулы          │
│ ⏭️  Нет, пропустить             │
└─────────────────────────────────┘
```

**Артикулы** - бот автоматически находит номера товаров на фотографиях (например: "02365") и добавляет их в конец подписи.

### Шаг 4: Отправка контента

#### Вариант А: Фото-посты
```
Отправьте 1-10 фотографий
↓
Бот подтвердит каждое фото
↓
Отправьте подпись (текст поста)
```

#### Вариант Б: Видео-посты
```
Отправьте видео-файл
↓
Бот подтвердит видео
↓
Отправьте подпись (текст поста)
```

#### Вариант В: Рилсы из Instagram
```
Отправьте ссылку на Instagram Reels
(например: https://www.instagram.com/reel/ABC123/)
↓
Бот скачает видео (показывает прогресс)
↓
Отправьте подпись (текст поста)
```

### Шаг 5: Предпросмотр и подтверждение
```
Бот покажет предпросмотр:
- Платформа публикации
- Тип контента
- Подпись
- Найденные артикулы (если есть)
```

### Шаг 6: Выбор времени публикации
```
┌─────────────────────────────────┐
│ ⚡ Опубликовать сейчас           │
│ ⏰ Запланировать                │
│ 🤖 Помощь ИИ                    │
└─────────────────────────────────┘
```

**Опции:**
- **⚡ Опубликовать сейчас** - мгновенная публикация
- **⏰ Запланировать** - выбрать дату и время
- **🤖 Помощь ИИ** - улучшить подпись с помощью AI

### Шаг 7: Публикация
```
Бот публикует контент
↓
Показывает результат
✅ "Опубликовано в Instagram, Telegram, VK!"
```

---

## 📊 Все Возможные Сценарии

### 🖼️ Сценарий 1: Одиночное фото → Instagram
```
/start → 🚀 Начать публикацию
  ↓
Выбрать: 📷 Instagram
  ↓
Выбрать: 🔍 Да, искать артикулы (или ⏭️ Нет, пропустить)
  ↓
Отправить 1 фото
  ↓
Отправить подпись
  ↓
⚡ Опубликовать сейчас
  ↓
✅ Опубликовано в Instagram!
```

### 🎠 Сценарий 2: Карусель фото → Все платформы
```
/start → 🚀 Начать публикацию
  ↓
Выбрать: 🔀 Все платформы
  ↓
Выбрать: 🔍 Да, искать артикулы
  ↓
Отправить 2-10 фото (по очереди)
  ↓
Отправить подпись
  ↓
⚡ Опубликовать сейчас
  ↓
✅ Опубликовано в Instagram, Telegram, VK!
```

### 📹 Сценарий 3: Видео → Telegram + VK
```
/start → 🚀 Начать публикацию
  ↓
Выбрать: 💬 Telegram (или 🔵 VK, или 🔀 Все)
  ↓
Отправить видео-файл
  ↓
Отправить подпись
  ↓
⚡ Опубликовать сейчас
  ↓
✅ Опубликовано в Telegram!
```

### 🎬 Сценарий 4: Рилсы Instagram → Все платформы
```
/start → 🚀 Начать публикацию
  ↓
Выбрать: 🔀 Все платформы
  ↓
Отправить ссылку: https://www.instagram.com/reel/ABC/
  ↓
Бот скачивает видео (показывает прогресс 0%...100%)
  ↓
Отправить подпись
  ↓
⚡ Опубликовать сейчас
  ↓
✅ Опубликовано в Instagram (как видео-пост), Telegram, VK!
```
**Примечание:** Рилсы публикуются в Instagram как обычные видео-посты, не как reels.

### ⏰ Сценарий 5: Запланированная публикация
```
/start → 🚀 Начать публикацию
  ↓
Выбрать платформу
  ↓
Отправить контент (фото/видео/ссылку)
  ↓
Отправить подпись
  ↓
⏰ Запланировать
  ↓
Отправить время: "15:30" или "завтра 10:00" или "2024-01-15 14:00"
  ↓
✅ Пост запланирован на [время]
  ↓
[В указанное время бот автоматически публикует]
```

### 🤖 Сценарий 6: Использование AI помощника
```
/start → 🚀 Начать публикацию
  ↓
Выбрать платформу
  ↓
Отправить контент
  ↓
Отправить подпись
  ↓
🤖 Помощь ИИ
  ↓
Бот улучшает подпись с помощью Google AI
  ↓
Показывает улучшенный вариант
  ↓
⚡ Опубликовать сейчас
```

---

## 📋 Управление Очередью Постов

### Добавление постов в очередь
```
/start → ➕ Добавить ссылку
  ↓
Выбрать платформу публикации
  ↓
Отправить ссылку на Instagram пост/рилс
  ↓
✅ Добавлено в очередь
```

### Просмотр очереди
```
/start → 📋 Очередь постов
  ↓
Бот показывает все посты в очереди:
- Ожидающие публикации
- Опубликованные
```

### Очистка очереди
```
/start → 📋 Очередь постов
  ↓
🗑️ Очистить опубликованные - удалить только опубликованные
или
❌ Очистить все - удалить всю очередь
```

---

## 🔧 Служебные Команды

### /status - Проверка статуса
```
/status
↓
Бот показывает статус всех сервисов:
✅ Instagram: подключен (username)
✅ Telegram: подключен
✅ VK: подключен (group_id)
✅ AI: активен
```

### /cancel - Отмена операции
```
В любой момент отправьте /cancel
↓
Бот остановит текущую операцию
Удалит временные файлы
Вернёт в главное меню
```

### /reset - Сброс Instagram сессии
```
/reset
↓
Бот:
1. Удалит старую сессию
2. Создаст новый клиент
3. Выполнит новый вход
↓
✅ Сессия сброшена
```

### /help - Справка
```
/help
↓
Бот показывает все доступные команды
и основные функции
```

---

## 🎨 Автоматическая Обработка Контента

### Фотографии
```
Входящее фото
  ↓
Проверка формата (JPEG, PNG, WebP)
  ↓
Определение формата:
  - Одиночное фото: 1080x1080 (квадрат) или 1080x1350 (портрет)
  - Карусель: все 1080x1080 (квадрат)
  ↓
Изменение размера
  ↓
Конвертация в JPEG (95% качество)
  ↓
Проверка артикулов (если включено)
  ↓
Готово к публикации
```

### Видео
```
Входящее видео
  ↓
Сохранение во временную папку
  ↓
Публикация "как есть"
  ↓
Удаление после публикации
```

### Рилсы из Instagram
```
Ссылка на рилс
  ↓
Извлечение ID
  ↓
Скачивание видео (с прогресс-баром)
  ↓
Извлечение подписи (опционально)
  ↓
Публикация
  ↓
Удаление после публикации
```

---

## 🔍 Поиск Артикулов

### Как работает
```
Фото → OCR (распознавание текста) → Поиск паттерна цифр
```

### Паттерны артикулов
- 5-6 цифр подряд (например: "12345", "023567")
- Игнорируются цены (содержащие "руб", "$", "₽")
- Игнорируются телефоны

### Результат
```
Найдены артикулы: 12345, 67890
  ↓
Добавляются в конец подписи:
"Ваш текст поста

Артикулы: 12345, 67890"
```

---

## ⚠️ Важные Особенности

### Instagram
- ✅ Фото-посты (1-10 фото)
- ✅ Видео-посты (обычные видео)
- ❌ Рилсы через API (публикуются как обычные видео)
- ⏱️ Задержка 1 секунда между публикациями (защита от бана)

### Telegram
- ✅ Фото-посты (1-10 фото)
- ✅ Видео-посты
- ✅ Медиа-группы (карусели)
- ⏱️ Мгновенная публикация

### VK
- ✅ Фото-посты (1-10 фото)
- ✅ Видео-посты
- ✅ Альбомы
- ⏱️ Мгновенная публикация

---

## 🎯 Быстрая Шпаргалка

### Хочу опубликовать фото в Instagram
```
/start → 🚀 → 📷 Instagram → 🔍 Да/Нет → Отправить фото → Подпись → ⚡
```

### Хочу опубликовать во все соц.сети
```
/start → 🚀 → 🔀 Все → 🔍 Да/Нет → Отправить контент → Подпись → ⚡
```

### Хочу репостнуть рилс
```
/start → 🚀 → Выбрать платформу → Отправить ссылку → Подпись → ⚡
```

### Хочу запланировать пост
```
/start → 🚀 → Платформа → Контент → Подпись → ⏰ → Время → ✅
```

### Хочу улучшить подпись AI
```
/start → 🚀 → Платформа → Контент → Подпись → 🤖 → ⚡
```

### Нужно отменить операцию
```
/cancel
```

### Проблемы с Instagram
```
/reset
```

### Проверить что всё работает
```
/status
```

---

## 🔄 Состояния Бота (Для Понимания)

Бот работает по принципу **машины состояний**. Каждый пользователь находится в определенном состоянии:

1. **start** - начальное состояние
2. **platform_selection** - выбор платформы
3. **article_check_selection** - выбор проверки артикулов
4. **content_input** - ожидание контента (фото/видео/ссылки)
5. **photos_upload** - загрузка дополнительных фото
6. **reels_url_input** - ожидание ссылки на рилс
7. **reels_download** - скачивание рилса
8. **reels_waiting_caption** - ожидание подписи для видео
9. **caption_entered** - подпись введена, ожидание выбора времени
10. **scheduled** - пост запланирован

---

## 🎓 Советы По Использованию

### ✅ Лучшие практики
- Используйте квадратные фото (1080x1080) для лучшей совместимости
- Пишите подписи до 2000 символов
- Для каруселей используйте 2-10 фото
- Проверяйте артикулы перед публикацией

### ❌ Чего избегать
- Не отправляйте больше 10 фото (Instagram ограничение)
- Не используйте очень большие видео (>50МБ)
- Не спамьте - делайте паузы между публикациями
- Не забывайте про /cancel если передумали

### 🔧 Решение проблем
- **Бот не отвечает** → /cancel и начните заново
- **Instagram не публикует** → /reset
- **Не находит артикулы** → Проверьте качество фото и контрастность текста
- **Ошибка публикации** → /status для проверки подключений

---

## 📞 Контакты и Поддержка

При возникновении проблем:
1. Проверьте логи бота в консоли
2. Используйте /status для диагностики
3. Попробуйте /reset для Instagram
4. Перезапустите бота

---

**Версия документа:** 1.0  
**Последнее обновление:** Октябрь 2024  
**Статус:** Актуально

